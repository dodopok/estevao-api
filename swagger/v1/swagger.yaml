---
openapi: 3.0.1
info:
  title: API - Calendário Litúrgico Anglicano
  version: v1
  description: API para consulta de calendário litúrgico anglicano, lecionário, celebrações
    e ofício diário. Inclui autenticação Firebase para recursos personalizados.
paths:
  "/api/v1/calendar/today":
    get:
      summary: today calendar
      tags:
      - Calendar
      responses:
        '200':
          description: successful
  "/api/v1/calendar/{year}/{month}/{day}":
    parameters:
    - name: year
      in: path
      description: year
      required: true
      schema:
        type: string
    - name: month
      in: path
      description: month
      required: true
      schema:
        type: string
    - name: day
      in: path
      description: day
      required: true
      schema:
        type: string
    get:
      summary: day calendar
      tags:
      - Calendar
      responses:
        '200':
          description: successful
  "/api/v1/calendar/{year}/{month}":
    parameters:
    - name: year
      in: path
      description: year
      required: true
      schema:
        type: string
    - name: month
      in: path
      description: month
      required: true
      schema:
        type: string
    get:
      summary: month calendar
      tags:
      - Calendar
      responses:
        '200':
          description: successful
  "/api/v1/calendar/{year}":
    parameters:
    - name: year
      in: path
      description: year
      required: true
      schema:
        type: string
    get:
      summary: year calendar
      tags:
      - Calendar
      responses:
        '200':
          description: successful
  "/api/v1/celebrations/search":
    get:
      summary: search celebration
      tags:
      - Celebrations
      responses:
        '200':
          description: successful
  "/api/v1/celebrations/types":
    get:
      summary: types celebration
      tags:
      - Celebrations
      responses:
        '200':
          description: successful
  "/api/v1/celebrations/date/{month}/{day}":
    parameters:
    - name: month
      in: path
      description: month
      required: true
      schema:
        type: string
    - name: day
      in: path
      description: day
      required: true
      schema:
        type: string
    get:
      summary: by_date celebration
      tags:
      - Celebrations
      responses:
        '200':
          description: successful
  "/api/v1/celebrations":
    get:
      summary: list celebrations
      tags:
      - Celebrations
      responses:
        '200':
          description: successful
  "/api/v1/celebrations/{id}":
    parameters:
    - name: id
      in: path
      description: id
      required: true
      schema:
        type: string
    get:
      summary: show celebration
      tags:
      - Celebrations
      responses:
        '200':
          description: successful
  "/api/v1/completions":
    post:
      summary: Mark office as completed
      tags:
      - Completions
      description: Marks a Daily Office as completed for the authenticated user and
        updates streak
      security:
      - bearer_auth: []
      parameters:
      - name: Authorization
        in: header
        description: 'Firebase ID Token (format: Bearer <token>)'
        required: true
        schema:
          type: string
      responses:
        '201':
          description: created
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Office completed successfully
                  completion:
                    type: object
                    properties:
                      id:
                        type: integer
                        example: 1
                      date_reference:
                        type: string
                        format: date
                        example: '2025-11-22'
                      office_type:
                        type: string
                        example: morning
                      duration_seconds:
                        type: integer
                        example: 600
                        nullable: true
                      created_at:
                        type: string
                        format: date-time
                        example: '2025-11-22T08:30:00Z'
                  current_streak:
                    type: integer
                    example: 8
                  longest_streak:
                    type: integer
                    example: 15
        '401':
          description: unauthorized
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: Unauthorized
        '422':
          description: unprocessable entity
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: 'Validation failed: User already completed this office
                      today'
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                completion:
                  type: object
                  properties:
                    office_type:
                      type: string
                      enum:
                      - morning
                      - midday
                      - evening
                      - compline
                      example: morning
                    duration_seconds:
                      type: integer
                      example: 600
                      description: 'Optional: duration in seconds spent on the office'
                  required:
                  - office_type
              required:
              - completion
  "/api/v1/completions/{id}":
    parameters:
    - name: id
      in: path
      description: Completion ID
      required: true
      schema:
        type: integer
    delete:
      summary: Remove completion
      tags:
      - Completions
      description: Removes a completion (in case of mistake) and recalculates streak
      security:
      - bearer_auth: []
      parameters:
      - name: Authorization
        in: header
        description: 'Firebase ID Token (format: Bearer <token>)'
        required: true
        schema:
          type: string
      responses:
        '200':
          description: successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Completion removed successfully
                  current_streak:
                    type: integer
                    example: 7
                  longest_streak:
                    type: integer
                    example: 15
        '401':
          description: unauthorized
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: Unauthorized
        '404':
          description: not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: Completion not found
  "/api/v1/daily_office/preferences":
    get:
      summary: Get available preferences
      tags:
      - Daily Office
      description: Returns all available options for customizing the Daily Office
        (versions, languages, Bible translations, etc.)
      responses:
        '200':
          description: successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  versions:
                    type: array
                    items:
                      type: string
                    example:
                    - loc_2015
                  languages:
                    type: array
                    items:
                      type: string
                    example:
                    - pt-BR
                    - en
                  bible_versions:
                    type: array
                    items:
                      type: string
                    example:
                    - nvi
                    - ntlh
                    - arc
                  lords_prayer_versions:
                    type: array
                    items:
                      type: string
                    example:
                    - traditional
                    - contemporary
                  creed_types:
                    type: array
                    items:
                      type: string
                    example:
                    - apostles
                    - nicene
                  confession_types:
                    type: array
                    items:
                      type: string
                    example:
                    - long
                    - short
                  office_types:
                    type: array
                    items:
                      type: string
                    example:
                    - morning
                    - midday
                    - evening
                    - compline
  "/api/v1/daily_office/today/{office_type}":
    parameters:
    - name: office_type
      in: path
      description: Type of office (morning, midday, evening, compline)
      required: true
      schema:
        type: string
    - name: version
      in: query
      description: 'LOC version (default: loc_2015)'
      required: false
      schema:
        type: string
    - name: bible_version
      in: query
      description: 'Bible translation (default: nvi)'
      required: false
      schema:
        type: string
    - name: language
      in: query
      description: 'Language (default: pt-BR)'
      required: false
      schema:
        type: string
    - name: lords_prayer_version
      in: query
      description: Lord's Prayer version (traditional/contemporary)
      required: false
      schema:
        type: string
    - name: creed_type
      in: query
      description: Creed type (apostles/nicene)
      required: false
      schema:
        type: string
    - name: confession_type
      in: query
      description: Confession type (long/short)
      required: false
      schema:
        type: string
    get:
      summary: Get today's Daily Office
      tags:
      - Daily Office
      description: Returns the complete liturgy for today's Daily Office with all
        modules (opening sentence, psalms, readings, canticles, prayers, etc.)
      responses:
        '200':
          description: successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  date:
                    type: string
                    example: '2025-11-22'
                  office_type:
                    type: string
                    example: morning
                  season:
                    type: string
                    example: Tempo Comum
                  color:
                    type: string
                    example: verde
                  celebration:
                    type: object
                    nullable: true
                  saint:
                    type: object
                    nullable: true
                  modules:
                    type: array
                    items:
                      type: object
                      properties:
                        name:
                          type: string
                          example: Sentença de Abertura
                        slug:
                          type: string
                          example: opening_sentence
                        lines:
                          type: array
                          items:
                            type: object
                            properties:
                              content:
                                type: string
                              line_type:
                                type: string
                                enum:
                                - heading
                                - subheading
                                - rubric
                                - leader
                                - congregation
                                - reader
                                - responsive
                                - citation
                                - html
                                - spacer
                              reference:
                                type: string
                                nullable: true
                              audio_id:
                                type: string
                                nullable: true
                  metadata:
                    type: object
                    properties:
                      version:
                        type: string
                        example: loc_2015
                      bible_version:
                        type: string
                        example: nvi
                      language:
                        type: string
                        example: pt-BR
        '400':
          description: invalid office type
  "/api/v1/daily_office/{year}/{month}/{day}/{office_type}":
    parameters:
    - name: year
      in: path
      description: Year (1900-2200)
      required: true
      schema:
        type: string
    - name: month
      in: path
      description: Month (1-12)
      required: true
      schema:
        type: string
    - name: day
      in: path
      description: Day (1-31)
      required: true
      schema:
        type: string
    - name: office_type
      in: path
      description: Type of office (morning, midday, evening, compline)
      required: true
      schema:
        type: string
    - name: version
      in: query
      description: 'LOC version (default: loc_2015)'
      required: false
      schema:
        type: string
    - name: bible_version
      in: query
      description: 'Bible translation (default: nvi)'
      required: false
      schema:
        type: string
    - name: language
      in: query
      description: 'Language (default: pt-BR)'
      required: false
      schema:
        type: string
    - name: lords_prayer_version
      in: query
      description: Lord's Prayer version (traditional/contemporary)
      required: false
      schema:
        type: string
    - name: creed_type
      in: query
      description: Creed type (apostles/nicene)
      required: false
      schema:
        type: string
    - name: confession_type
      in: query
      description: Confession type (long/short)
      required: false
      schema:
        type: string
    get:
      summary: Get Daily Office for specific date
      tags:
      - Daily Office
      description: Returns the complete liturgy for a specific date's Daily Office
      responses:
        '200':
          description: successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  date:
                    type: string
                    example: '2025-12-25'
                  office_type:
                    type: string
                    example: morning
                  season:
                    type: string
                    example: Natal
                  color:
                    type: string
                    example: branco
                  celebration:
                    type: object
                    nullable: true
                  saint:
                    type: object
                    nullable: true
                  modules:
                    type: array
                    items:
                      type: object
                      properties:
                        name:
                          type: string
                        slug:
                          type: string
                        lines:
                          type: array
                          items:
                            type: object
                            properties:
                              content:
                                type: string
                              line_type:
                                type: string
                              reference:
                                type: string
                                nullable: true
                              audio_id:
                                type: string
                                nullable: true
                  metadata:
                    type: object
                    properties:
                      version:
                        type: string
                      bible_version:
                        type: string
                      language:
                        type: string
        '400':
          description: invalid office type
  "/api/v1/lectionary/{year}/{month}/{day}":
    parameters:
    - name: year
      in: path
      description: year
      required: true
      schema:
        type: string
    - name: month
      in: path
      description: month
      required: true
      schema:
        type: string
    - name: day
      in: path
      description: day
      required: true
      schema:
        type: string
    get:
      summary: day lectionary
      tags:
      - Lectionary
      responses:
        '200':
          description: successful
  "/api/v1/lectionary/{year}/{month}/{day}/all_services":
    parameters:
    - name: year
      in: path
      description: year
      required: true
      schema:
        type: string
    - name: month
      in: path
      description: month
      required: true
      schema:
        type: string
    - name: day
      in: path
      description: day
      required: true
      schema:
        type: string
    get:
      summary: all_services lectionary
      tags:
      - Lectionary
      responses:
        '200':
          description: successful
  "/api/v1/lectionary/cycle/{year}":
    parameters:
    - name: year
      in: path
      description: year
      required: true
      schema:
        type: string
    get:
      summary: cycle_info lectionary
      tags:
      - Lectionary
      responses:
        '200':
          description: successful
  "/api/v1/notifications/send":
    post:
      summary: Send notifications to specific users
      tags:
      - Notifications
      description: Sends push notifications to specific users (Admin only)
      security:
      - bearer_auth: []
      parameters:
      - name: Authorization
        in: header
        description: 'Firebase ID Token (format: Bearer <token>) - Must be admin user'
        required: true
        schema:
          type: string
      responses:
        '200':
          description: successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Notificações enviadas
                  sent_count:
                    type: integer
                    example: 3
                  failed_count:
                    type: integer
                    example: 0
        '401':
          description: unauthorized
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: Unauthorized
        '403':
          description: forbidden
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: Unauthorized - Admin access required
        '422':
          description: unprocessable entity
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: user_ids, title, and body are required
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                user_ids:
                  type: array
                  items:
                    type: integer
                  example:
                  - 1
                  - 2
                  - 3
                title:
                  type: string
                  example: Título da notificação
                body:
                  type: string
                  example: Corpo da notificação
                data:
                  type: object
                  properties:
                    type:
                      type: string
                      example: new_feature
                    url:
                      type: string
                      example: "/path/to/feature"
              required:
              - user_ids
              - title
              - body
  "/api/v1/notifications/broadcast":
    post:
      summary: Broadcast notification to all users
      tags:
      - Notifications
      description: Sends push notification to all users with active FCM tokens (Admin
        only)
      security:
      - bearer_auth: []
      parameters:
      - name: Authorization
        in: header
        description: 'Firebase ID Token (format: Bearer <token>) - Must be admin user'
        required: true
        schema:
          type: string
      responses:
        '202':
          description: accepted - broadcast started in background
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Broadcast iniciado em background
                  total_users:
                    type: integer
                    example: 1500
        '200':
          description: successful - broadcast completed
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Broadcast concluído
                  total_users:
                    type: integer
                    example: 1500
                  sent_count:
                    type: integer
                    example: 1450
                  failed_count:
                    type: integer
                    example: 50
        '401':
          description: unauthorized
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: Unauthorized
        '403':
          description: forbidden
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: Unauthorized - Admin access required
        '422':
          description: unprocessable entity
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: title and body are required
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                title:
                  type: string
                  example: Novo recurso disponível!
                body:
                  type: string
                  example: Confira as novas funcionalidades do Ordo
                data:
                  type: object
                  properties:
                    type:
                      type: string
                      example: announcement
                    url:
                      type: string
                      example: "/announcements/123"
              required:
              - title
              - body
  "/api/v1/users/me":
    get:
      summary: Get current user profile
      tags:
      - Users
      description: Returns the authenticated user profile including preferences and
        streak information
      security:
      - bearer_auth: []
      parameters:
      - name: Authorization
        in: header
        description: 'Firebase ID Token (format: Bearer <token>)'
        required: true
        schema:
          type: string
      responses:
        '200':
          description: successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: integer
                    example: 1
                  email:
                    type: string
                    example: user@example.com
                  name:
                    type: string
                    example: João Silva
                  photo_url:
                    type: string
                    example: https://example.com/photo.jpg
                    nullable: true
                  preferences:
                    type: object
                    properties:
                      version:
                        type: string
                        example: loc_2015
                      language:
                        type: string
                        example: pt-BR
                      bible_version:
                        type: string
                        example: nvi
                      lords_prayer_version:
                        type: string
                        example: traditional
                      creed_type:
                        type: string
                        example: apostles
                      confession_type:
                        type: string
                        example: long
                      notifications:
                        type: boolean
                        example: true
                      notifications_enabled:
                        type: boolean
                        example: true
                      streak_reminder_enabled:
                        type: boolean
                        example: true
                      prayer_times:
                        type: array
                        items:
                          type: object
                          properties:
                            office_id:
                              type: string
                              example: '1'
                            office_name:
                              type: string
                              example: Matutino
                            hour:
                              type: integer
                              example: 6
                            minute:
                              type: integer
                              example: 0
                            enabled:
                              type: boolean
                              example: true
                  current_streak:
                    type: integer
                    example: 7
                  longest_streak:
                    type: integer
                    example: 15
                  last_completed_office_at:
                    type: string
                    format: date-time
                    example: '2025-11-22T08:30:00Z'
                    nullable: true
        '401':
          description: unauthorized
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: Unauthorized
  "/api/v1/users/preferences":
    patch:
      summary: Update user preferences
      tags:
      - Users
      description: Updates user preferences for customizing the Daily Office experience
      security:
      - bearer_auth: []
      parameters:
      - name: Authorization
        in: header
        description: 'Firebase ID Token (format: Bearer <token>)'
        required: true
        schema:
          type: string
      responses:
        '200':
          description: successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Preferences updated successfully
                  preferences:
                    type: object
                    properties:
                      version:
                        type: string
                      language:
                        type: string
                      bible_version:
                        type: string
                      lords_prayer_version:
                        type: string
                      creed_type:
                        type: string
                      confession_type:
                        type: string
                      notifications:
                        type: boolean
        '401':
          description: unauthorized
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: Unauthorized
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                preferences:
                  type: object
                  properties:
                    version:
                      type: string
                      example: loc_2015
                    language:
                      type: string
                      example: pt-BR
                    bible_version:
                      type: string
                      example: nvi
                    lords_prayer_version:
                      type: string
                      example: traditional
                    creed_type:
                      type: string
                      example: apostles
                    confession_type:
                      type: string
                      example: long
                    notifications:
                      type: boolean
                      example: true
                    notifications_enabled:
                      type: boolean
                      example: true
                    streak_reminder_enabled:
                      type: boolean
                      example: true
                    prayer_times:
                      type: array
                      items:
                        type: object
                        properties:
                          office_id:
                            type: string
                            example: '1'
                          office_name:
                            type: string
                            example: Matutino
                          hour:
                            type: integer
                            example: 6
                          minute:
                            type: integer
                            example: 0
                          enabled:
                            type: boolean
                            example: true
              required:
              - preferences
  "/api/v1/users/completions":
    get:
      summary: Get user completion history
      tags:
      - Users
      description: Returns the authenticated user completion history with streak information
      security:
      - bearer_auth: []
      parameters:
      - name: Authorization
        in: header
        description: 'Firebase ID Token (format: Bearer <token>)'
        required: true
        schema:
          type: string
      - name: limit
        in: query
        description: 'Limit number of results (default: 30)'
        required: false
        schema:
          type: integer
      responses:
        '200':
          description: successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  completions:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: integer
                          example: 1
                        date_reference:
                          type: string
                          format: date
                          example: '2025-11-22'
                        office_type:
                          type: string
                          example: morning
                        duration_seconds:
                          type: integer
                          example: 600
                          nullable: true
                        created_at:
                          type: string
                          format: date-time
                          example: '2025-11-22T08:30:00Z'
                  total_completions:
                    type: integer
                    example: 42
                  current_streak:
                    type: integer
                    example: 7
                  longest_streak:
                    type: integer
                    example: 15
        '401':
          description: unauthorized
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: Unauthorized
  "/api/v1/users/fcm_token":
    post:
      summary: Save FCM token for push notifications
      tags:
      - Users
      description: Saves or updates the FCM (Firebase Cloud Messaging) token for the
        authenticated user to enable push notifications
      security:
      - bearer_auth: []
      parameters:
      - name: Authorization
        in: header
        description: 'Firebase ID Token (format: Bearer <token>)'
        required: true
        schema:
          type: string
      responses:
        '200':
          description: successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Token FCM salvo com sucesso
                  fcm_token:
                    type: string
                    example: fK8x9y2ZqR3...
        '401':
          description: unauthorized
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: Unauthorized
        '422':
          description: unprocessable entity
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: FCM token is required
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                fcm_token:
                  type: string
                  example: fK8x9y2ZqR3...
                platform:
                  type: string
                  enum:
                  - android
                  - ios
                  - web
                  example: android
              required:
              - fcm_token
    delete:
      summary: Remove FCM token
      tags:
      - Users
      description: Removes the FCM token for the authenticated user (e.g., when logging
        out or disabling notifications)
      security:
      - bearer_auth: []
      parameters:
      - name: Authorization
        in: header
        description: 'Firebase ID Token (format: Bearer <token>)'
        required: true
        schema:
          type: string
      - name: fcm_token
        in: query
        description: FCM token to remove
        required: true
        schema:
          type: string
      responses:
        '200':
          description: successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Token FCM removido com sucesso
        '401':
          description: unauthorized
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: Unauthorized
        '422':
          description: unprocessable entity
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: FCM token is required
servers:
- url: http://localhost:3000
  description: Development server
- url: https://api.caminhoanglicano.com.br
  description: Production server
components:
  securitySchemes:
    bearer_auth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: Firebase ID Token. Obtenha através do Firebase Authentication no
        app Flutter.
