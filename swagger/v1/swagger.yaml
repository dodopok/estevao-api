---
openapi: 3.0.1
info:
  title: API - Calendário Litúrgico Anglicano
  version: v1
  description: API para consulta de calendário litúrgico anglicano, lecionário, celebrações
    e ofício diário. Inclui autenticação Firebase para recursos personalizados.
paths:
  "/api/v1/bible_versions":
    get:
      summary: list bible versions
      tags:
      - Bible Versions
      responses:
        '200':
          description: successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: string
                        code:
                          type: string
                        name:
                          type: string
                        full_name:
                          type: string
                        language:
                          type: string
                        description:
                          type: string
                        publisher:
                          type: string
                        year:
                          type: integer
                        is_recommended:
                          type: boolean
                        license:
                          type: string
                        created_at:
                          type: string
                          format: datetime
                  metadata:
                    type: object
                    properties:
                      total:
                        type: integer
                      last_updated:
                        type: string
                        nullable: true
  "/api/v1/calendar/today":
    get:
      summary: today calendar
      tags:
      - Calendar
      security:
      - bearer_auth: []
      - {}
      parameters:
      - name: Authorization
        in: header
        required: false
        description: Optional Firebase auth token (Bearer)
        schema:
          type: string
      - name: preferences
        in: query
        required: true
        description: 'User preferences as JSON string. Required fields: prayer_book_code.
          Example: {"prayer_book_code":"loc_2015","bible_version":"nvi"}'
        schema:
          type: string
      responses:
        '200':
          description: successful
        '400':
          description: missing prayer_book_code
  "/api/v1/calendar/{year}/{month}/{day}":
    parameters:
    - name: year
      in: path
      description: year
      required: true
      schema:
        type: string
    - name: month
      in: path
      description: month
      required: true
      schema:
        type: string
    - name: day
      in: path
      description: day
      required: true
      schema:
        type: string
    get:
      summary: day calendar
      tags:
      - Calendar
      security:
      - bearer_auth: []
      - {}
      parameters:
      - name: Authorization
        in: header
        required: false
        description: Optional Firebase auth token (Bearer)
        schema:
          type: string
      - name: preferences
        in: query
        required: true
        description: 'User preferences as JSON string. Required: prayer_book_code'
        schema:
          type: string
      responses:
        '200':
          description: successful
  "/api/v1/calendar/{year}/{month}":
    parameters:
    - name: year
      in: path
      description: year
      required: true
      schema:
        type: string
    - name: month
      in: path
      description: month
      required: true
      schema:
        type: string
    get:
      summary: month calendar
      tags:
      - Calendar
      security:
      - bearer_auth: []
      - {}
      parameters:
      - name: Authorization
        in: header
        required: false
        description: Optional Firebase auth token (Bearer)
        schema:
          type: string
      - name: preferences
        in: query
        required: true
        description: 'User preferences as JSON string. Required: prayer_book_code'
        schema:
          type: string
      responses:
        '200':
          description: successful
  "/api/v1/calendar/{year}":
    parameters:
    - name: year
      in: path
      description: year
      required: true
      schema:
        type: string
    get:
      summary: year calendar
      tags:
      - Calendar
      security:
      - bearer_auth: []
      - {}
      parameters:
      - name: Authorization
        in: header
        required: false
        description: Optional Firebase auth token (Bearer)
        schema:
          type: string
      - name: preferences
        in: query
        required: true
        description: 'User preferences as JSON string. Required: prayer_book_code'
        schema:
          type: string
      responses:
        '200':
          description: successful
  "/api/v1/celebrations/search":
    get:
      summary: search celebration
      tags:
      - Celebrations
      security:
      - bearer_auth: []
      - {}
      parameters:
      - name: Authorization
        in: header
        required: false
        description: Optional Firebase auth token (Bearer)
        schema:
          type: string
      - name: preferences
        in: query
        required: true
        description: 'User preferences as JSON string. Required: prayer_book_code'
        schema:
          type: string
      - name: q
        in: query
        required: false
        description: Search query
        schema:
          type: string
      responses:
        '200':
          description: successful
  "/api/v1/celebrations/types":
    get:
      summary: types celebration
      tags:
      - Celebrations
      responses:
        '200':
          description: successful
  "/api/v1/celebrations/date/{month}/{day}":
    parameters:
    - name: month
      in: path
      description: month
      required: true
      schema:
        type: string
    - name: day
      in: path
      description: day
      required: true
      schema:
        type: string
    get:
      summary: by_date celebration
      tags:
      - Celebrations
      security:
      - bearer_auth: []
      - {}
      parameters:
      - name: Authorization
        in: header
        required: false
        description: Optional Firebase auth token (Bearer)
        schema:
          type: string
      - name: preferences
        in: query
        required: true
        description: 'User preferences as JSON string. Required: prayer_book_code'
        schema:
          type: string
      responses:
        '200':
          description: successful
  "/api/v1/celebrations":
    get:
      summary: list celebrations
      tags:
      - Celebrations
      security:
      - bearer_auth: []
      - {}
      parameters:
      - name: Authorization
        in: header
        required: false
        description: Optional Firebase auth token (Bearer)
        schema:
          type: string
      - name: preferences
        in: query
        required: true
        description: 'User preferences as JSON string. Required: prayer_book_code'
        schema:
          type: string
      responses:
        '200':
          description: successful
  "/api/v1/celebrations/{id}":
    parameters:
    - name: id
      in: path
      description: id
      required: true
      schema:
        type: string
    get:
      summary: show celebration
      tags:
      - Celebrations
      security:
      - bearer_auth: []
      - {}
      parameters:
      - name: Authorization
        in: header
        required: false
        description: Optional Firebase auth token (Bearer)
        schema:
          type: string
      - name: preferences
        in: query
        required: true
        description: 'User preferences as JSON string. Required: prayer_book_code'
        schema:
          type: string
      responses:
        '200':
          description: successful
  "/api/v1/completions":
    post:
      summary: Mark office as completed
      tags:
      - Completions
      description: Marks a Daily Office as completed for the authenticated user and
        updates streak
      security:
      - bearer_auth: []
      parameters:
      - name: Authorization
        in: header
        description: 'Firebase ID Token (format: Bearer <token>)'
        required: true
        schema:
          type: string
      responses:
        '201':
          description: created
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Office completed successfully
                  completion:
                    type: object
                    properties:
                      id:
                        type: integer
                        example: 1
                      date_reference:
                        type: string
                        format: date
                        example: '2025-11-22'
                      office_type:
                        type: string
                        example: morning
                      duration_seconds:
                        type: integer
                        example: 600
                        nullable: true
                      created_at:
                        type: string
                        format: date-time
                        example: '2025-11-22T08:30:00Z'
                  current_streak:
                    type: integer
                    example: 8
                  longest_streak:
                    type: integer
                    example: 15
        '401':
          description: unauthorized
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: Unauthorized
        '422':
          description: unprocessable entity
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: 'Validation failed: User already completed this office
                      today'
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                office_type:
                  type: string
                  enum:
                  - morning
                  - midday
                  - evening
                  - compline
                  example: morning
                date:
                  type: string
                  format: date
                  example: '2025-11-22'
                  description: 'Optional: date reference for the completion (defaults
                    to today)'
                duration_seconds:
                  type: integer
                  example: 600
                  description: 'Optional: duration in seconds spent on the office'
              required:
              - office_type
  "/api/v1/completions/{year}/{month}/{day}/{office_type}":
    parameters:
    - name: year
      in: path
      description: Year
      required: true
      example: 2025
      schema:
        type: integer
    - name: month
      in: path
      description: Month
      required: true
      example: 11
      schema:
        type: integer
    - name: day
      in: path
      description: Day
      required: true
      example: 22
      schema:
        type: integer
    - name: office_type
      in: path
      description: Office type
      required: true
      enum:
      - morning
      - midday
      - evening
      - compline
      example: morning
      schema:
        type: string
    get:
      summary: Check if office was completed
      tags:
      - Completions
      description: Checks if a specific Daily Office was completed for a given date
      security:
      - bearer_auth: []
      parameters:
      - name: Authorization
        in: header
        description: 'Firebase ID Token (format: Bearer <token>)'
        required: true
        schema:
          type: string
      responses:
        '200':
          description: completed
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Office completed
                  completion:
                    type: object
                    properties:
                      id:
                        type: integer
                        example: 1
                      created_at:
                        type: string
                        format: date-time
                        example: '2025-11-22T08:30:00Z'
        '404':
          description: not completed
          content:
            application/json:
              schema:
                type: object
  "/api/v1/completions/{id}":
    parameters:
    - name: id
      in: path
      description: Completion ID
      required: true
      schema:
        type: integer
    delete:
      summary: Remove completion
      tags:
      - Completions
      description: Removes a completion (in case of mistake) and recalculates streak
      security:
      - bearer_auth: []
      parameters:
      - name: Authorization
        in: header
        description: 'Firebase ID Token (format: Bearer <token>)'
        required: true
        schema:
          type: string
      responses:
        '200':
          description: successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Completion removed successfully
                  current_streak:
                    type: integer
                    example: 7
                  longest_streak:
                    type: integer
                    example: 15
        '401':
          description: unauthorized
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: Unauthorized
        '404':
          description: not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: Completion not found
  "/api/v1/daily_office/preferences":
    get:
      summary: Get available preferences
      tags:
      - Daily Office
      description: Returns all available options for customizing the Daily Office
        (versions, languages, Bible translations, etc.)
      responses:
        '200':
          description: successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  versions:
                    type: array
                    items:
                      type: string
                    example:
                    - loc_2015
                  languages:
                    type: array
                    items:
                      type: string
                    example:
                    - pt-BR
                    - en
                  bible_versions:
                    type: array
                    items:
                      type: string
                    example:
                    - acf
                    - ara
                    - arc
                    - as21
                    - jfaa
                    - kja
                    - kjf
                    - naa
                    - nbv
                    - ntlh
                    - nvi
                    - nvt
                    - tb
                  lords_prayer_versions:
                    type: array
                    items:
                      type: string
                    example:
                    - traditional
                    - contemporary
                  creed_types:
                    type: array
                    items:
                      type: string
                    example:
                    - apostles
                    - nicene
                  confession_types:
                    type: array
                    items:
                      type: string
                    example:
                    - long
                    - short
                  office_types:
                    type: array
                    items:
                      type: string
                    example:
                    - morning
                    - midday
                    - evening
                    - compline
  "/api/v1/daily_office/today/{office_type}":
    parameters:
    - name: office_type
      in: path
      required: true
      description: Type of office (morning, midday, evening, compline)
      schema:
        type: string
        enum:
        - morning
        - midday
        - evening
        - compline
    - name: preferences
      in: query
      required: true
      description: 'User preferences as JSON string. Required: prayer_book_code. Optional:
        bible_version, language, lords_prayer_version, creed_type, confession_type,
        seed'
      schema:
        type: string
    get:
      summary: Get today's Daily Office
      tags:
      - Daily Office
      description: Returns the complete liturgy for today's Daily Office with all
        modules (opening sentence, psalms, readings, canticles, prayers, etc.)
      responses:
        '200':
          description: successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  date:
                    type: string
                    example: '2025-11-22'
                  office_type:
                    type: string
                    example: morning
                  season:
                    type: string
                    example: Tempo Comum
                    nullable: true
                  color:
                    type: string
                    example: verde
                    nullable: true
                  celebration:
                    type: object
                    nullable: true
                  saint:
                    type: object
                    nullable: true
                  modules:
                    type: array
                    items:
                      type: object
                      properties:
                        name:
                          type: string
                          example: Sentença de Abertura
                        slug:
                          type: string
                          example: opening_sentence
                        lines:
                          type: array
                          items:
                            type: object
                            properties:
                              content:
                                type: string
                              line_type:
                                type: string
                                enum:
                                - heading
                                - subheading
                                - rubric
                                - leader
                                - congregation
                                - reader
                                - responsive
                                - citation
                                - html
                                - spacer
                              reference:
                                type: string
                                nullable: true
                              audio_id:
                                type: string
                                nullable: true
                  metadata:
                    type: object
                    properties:
                      prayer_book_code:
                        type: string
                        example: loc_2015
                      prayer_book_name:
                        type: string
                        example: Livro de Oração Comum - IEAB 2015
                      bible_version:
                        type: string
                        example: nvi
                      language:
                        type: string
                        example: pt-BR
                      seed:
                        type: integer
                        example: 1234567890
                        description: Seed used for deterministic randomization (for
                          sharing)
        '400':
          description: invalid office type
  "/api/v1/daily_office/{year}/{month}/{day}/{office_type}":
    parameters:
    - name: year
      in: path
      description: Year (1900-2200)
      required: true
      schema:
        type: string
    - name: month
      in: path
      description: Month (1-12)
      required: true
      schema:
        type: string
    - name: day
      in: path
      description: Day (1-31)
      required: true
      schema:
        type: string
    - name: office_type
      in: path
      required: true
      description: Type of office (morning, midday, evening, compline)
      schema:
        type: string
        enum:
        - morning
        - midday
        - evening
        - compline
    - name: preferences
      in: query
      required: true
      description: 'User preferences as JSON string. Required: prayer_book_code'
      schema:
        type: string
    get:
      summary: Get Daily Office for specific date
      tags:
      - Daily Office
      description: Returns the complete liturgy for a specific date's Daily Office
      responses:
        '200':
          description: successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  date:
                    type: string
                    example: '2025-12-25'
                  office_type:
                    type: string
                    example: morning
                  season:
                    type: string
                    example: Natal
                    nullable: true
                  color:
                    type: string
                    example: branco
                    nullable: true
                  celebration:
                    type: object
                    nullable: true
                  saint:
                    type: object
                    nullable: true
                  modules:
                    type: array
                    items:
                      type: object
                      properties:
                        name:
                          type: string
                        slug:
                          type: string
                        lines:
                          type: array
                          items:
                            type: object
                            properties:
                              content:
                                type: string
                              line_type:
                                type: string
                              reference:
                                type: string
                                nullable: true
                              audio_id:
                                type: string
                                nullable: true
                  metadata:
                    type: object
                    properties:
                      prayer_book_code:
                        type: string
                      prayer_book_name:
                        type: string
                      bible_version:
                        type: string
                      language:
                        type: string
                      seed:
                        type: integer
                        description: Seed used for deterministic randomization (for
                          sharing)
        '400':
          description: invalid office type
  "/api/v1/daily_office/{year}/{month}/{day}/{office_type}/family":
    parameters:
    - name: year
      in: path
      required: true
      schema:
        type: integer
      example: 2025
    - name: month
      in: path
      required: true
      schema:
        type: integer
      example: 11
    - name: day
      in: path
      required: true
      schema:
        type: integer
      example: 25
    - name: office_type
      in: path
      required: true
      description: Type of office (morning or evening only)
      schema:
        type: string
        enum:
        - morning
        - evening
    - name: preferences
      in: query
      required: true
      description: 'User preferences as JSON string. Required: prayer_book_code'
      schema:
        type: string
    get:
      summary: Get family rite daily office
      tags:
      - Daily Office
      description: Returns a simplified family rite version of the daily office with
        reduced components (8 components instead of 15-18)
      parameters:
      - name: Authorization
        in: header
        required: false
        description: Optional Firebase auth token (Bearer)
        schema:
          type: string
      responses:
        '200':
          description: successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  date:
                    type: string
                    example: '2025-11-25'
                  office_type:
                    type: string
                    example: morning
                  season:
                    type: string
                    example: Tempo Comum
                  modules:
                    type: array
                    description: Simplified list of 6-8 modules for family rite
                    items:
                      type: object
                      properties:
                        name:
                          type: string
                        slug:
                          type: string
                        lines:
                          type: array
                          items:
                            type: object
                  metadata:
                    type: object
                    properties:
                      prayer_book_code:
                        type: string
                      prayer_book_name:
                        type: string
                      bible_version:
                        type: string
        '422':
          description: Unprocessable entity - Prayer Book doesn't support family rite
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: O Prayer Book 'loc_1987' não suporta rito familiar
  "/api/v1/lectionary/{year}/{month}/{day}":
    parameters:
    - name: year
      in: path
      description: year
      required: true
      schema:
        type: string
    - name: month
      in: path
      description: month
      required: true
      schema:
        type: string
    - name: day
      in: path
      description: day
      required: true
      schema:
        type: string
    get:
      summary: day lectionary
      tags:
      - Lectionary
      security:
      - bearer_auth: []
      - {}
      parameters:
      - name: Authorization
        in: header
        required: false
        description: Optional Firebase auth token (Bearer)
        schema:
          type: string
      - name: preferences
        in: query
        required: true
        description: 'User preferences as JSON string. Required: prayer_book_code'
        schema:
          type: string
      responses:
        '200':
          description: successful
  "/api/v1/lectionary/{year}/{month}/{day}/all_services":
    parameters:
    - name: year
      in: path
      description: year
      required: true
      schema:
        type: string
    - name: month
      in: path
      description: month
      required: true
      schema:
        type: string
    - name: day
      in: path
      description: day
      required: true
      schema:
        type: string
    get:
      summary: all_services lectionary
      tags:
      - Lectionary
      security:
      - bearer_auth: []
      - {}
      parameters:
      - name: Authorization
        in: header
        required: false
        description: Optional Firebase auth token (Bearer)
        schema:
          type: string
      - name: preferences
        in: query
        required: true
        description: 'User preferences as JSON string. Required: prayer_book_code'
        schema:
          type: string
      responses:
        '200':
          description: successful
  "/api/v1/lectionary/cycle/{year}":
    parameters:
    - name: year
      in: path
      description: year
      required: true
      schema:
        type: string
    get:
      summary: cycle_info lectionary
      tags:
      - Lectionary
      parameters:
      - name: preferences
        in: query
        required: true
        description: 'User preferences as JSON string. Required: prayer_book_code'
        schema:
          type: string
      responses:
        '200':
          description: successful
  "/api/v1/life_rules":
    get:
      summary: List life rules
      tags:
      - Life Rules
      description: Returns public approved life rules and user's own life rules
      security:
      - bearer_auth: []
      parameters:
      - name: Authorization
        in: header
        description: 'Firebase ID Token (format: Bearer <token>)'
        required: true
        schema:
          type: string
      - name: search
        in: query
        description: Search by title
        required: false
        schema:
          type: string
      - name: sort
        in: query
        description: 'Sort by popularity (value: "popular")'
        required: false
        schema:
          type: string
      - name: limit
        in: query
        description: 'Number of results to return (default: 20, max: 100)'
        required: false
        schema:
          type: integer
      - name: offset
        in: query
        description: 'Number of results to skip (default: 0)'
        required: false
        schema:
          type: integer
      responses:
        '200':
          description: successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  life_rules:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: integer
                        icon:
                          type: string
                        title:
                          type: string
                        description:
                          type: string
                        is_public:
                          type: boolean
                        approved:
                          type: boolean
                        adoption_count:
                          type: integer
                        is_owner:
                          type: boolean
                        created_at:
                          type: string
                          format: date-time
                  pagination:
                    type: object
                    properties:
                      total:
                        type: integer
                      limit:
                        type: integer
                      offset:
                        type: integer
                      count:
                        type: integer
                    required:
                    - total
                    - limit
                    - offset
                    - count
                required:
                - life_rules
                - pagination
    post:
      summary: Create a life rule
      tags:
      - Life Rules
      description: Creates a new life rule for the authenticated user (replaces existing
        one)
      security:
      - bearer_auth: []
      parameters:
      - name: Authorization
        in: header
        description: 'Firebase ID Token (format: Bearer <token>)'
        required: true
        schema:
          type: string
      responses:
        '201':
          description: created
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  life_rule:
                    type: object
                    properties:
                      id:
                        type: integer
                      icon:
                        type: string
                      title:
                        type: string
                      description:
                        type: string
                      is_public:
                        type: boolean
                      approved:
                        type: boolean
                      adoption_count:
                        type: integer
                      is_owner:
                        type: boolean
                      created_at:
                        type: string
                        format: date-time
                      steps:
                        type: array
                        items:
                          type: object
                          properties:
                            id:
                              type: integer
                            order:
                              type: integer
                            title:
                              type: string
                            description:
                              type: string
        '422':
          description: unprocessable entity
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: array
                    items:
                      type: string
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                icon:
                  type: string
                  example: "\U0001F4D6"
                title:
                  type: string
                  example: Morning Routine
                description:
                  type: string
                  example: My daily morning routine
                is_public:
                  type: boolean
                  example: false
                life_rule_steps_attributes:
                  type: array
                  items:
                    type: object
                    properties:
                      order:
                        type: integer
                        example: 1
                      title:
                        type: string
                        example: Wake up early
                      description:
                        type: string
                        example: Wake up at 6 AM
              required:
              - icon
              - title
  "/api/v1/life_rules/my":
    get:
      summary: Get current user's life rule
      tags:
      - Life Rules
      description: Returns the life rule owned by the current authenticated user
      security:
      - bearer_auth: []
      parameters:
      - name: Authorization
        in: header
        description: 'Firebase ID Token (format: Bearer <token>)'
        required: true
        schema:
          type: string
      responses:
        '200':
          description: successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  life_rule:
                    type: object
                    properties:
                      id:
                        type: integer
                      icon:
                        type: string
                      title:
                        type: string
                      description:
                        type: string
                      is_public:
                        type: boolean
                      approved:
                        type: boolean
                      adoption_count:
                        type: integer
                      is_owner:
                        type: boolean
                      created_at:
                        type: string
                        format: date-time
                      steps:
                        type: array
                        items:
                          type: object
                          properties:
                            id:
                              type: integer
                            order:
                              type: integer
                            title:
                              type: string
                            description:
                              type: string
        '404':
          description: not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
  "/api/v1/life_rules/{id}":
    parameters:
    - name: id
      in: path
      required: true
      schema:
        type: integer
    get:
      summary: Show a life rule
      tags:
      - Life Rules
      description: Shows a specific life rule (must be public approved or owned by
        user)
      security:
      - bearer_auth: []
      parameters:
      - name: Authorization
        in: header
        description: 'Firebase ID Token (format: Bearer <token>)'
        required: true
        schema:
          type: string
      responses:
        '200':
          description: successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  life_rule:
                    type: object
                    properties:
                      id:
                        type: integer
                      icon:
                        type: string
                      title:
                        type: string
                      description:
                        type: string
                      is_public:
                        type: boolean
                      approved:
                        type: boolean
                      adoption_count:
                        type: integer
                      is_owner:
                        type: boolean
                      created_at:
                        type: string
                        format: date-time
                      steps:
                        type: array
        '404':
          description: not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
    patch:
      summary: Update a life rule
      tags:
      - Life Rules
      description: Updates a life rule (only if owned by user)
      security:
      - bearer_auth: []
      parameters:
      - name: Authorization
        in: header
        description: 'Firebase ID Token (format: Bearer <token>)'
        required: true
        schema:
          type: string
      responses:
        '200':
          description: successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  life_rule:
                    type: object
        '403':
          description: forbidden
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                icon:
                  type: string
                title:
                  type: string
                description:
                  type: string
                is_public:
                  type: boolean
    delete:
      summary: Delete a life rule
      tags:
      - Life Rules
      description: Deletes a life rule (only if owned by user)
      security:
      - bearer_auth: []
      parameters:
      - name: Authorization
        in: header
        description: 'Firebase ID Token (format: Bearer <token>)'
        required: true
        schema:
          type: string
      responses:
        '200':
          description: successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
        '403':
          description: forbidden
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
  "/api/v1/life_rules/{id}/adopt":
    parameters:
    - name: id
      in: path
      required: true
      schema:
        type: integer
    post:
      summary: Adopt a life rule
      tags:
      - Life Rules
      description: Adopts a public approved life rule (creates a copy for current
        user)
      security:
      - bearer_auth: []
      parameters:
      - name: Authorization
        in: header
        description: 'Firebase ID Token (format: Bearer <token>)'
        required: true
        schema:
          type: string
      responses:
        '201':
          description: created
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  life_rule:
                    type: object
        '404':
          description: not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
  "/api/v1/life_rules/{id}/approve":
    parameters:
    - name: id
      in: path
      required: true
      schema:
        type: integer
    post:
      summary: Approve a life rule
      tags:
      - Life Rules
      description: Approves a life rule (admin only)
      security:
      - bearer_auth: []
      parameters:
      - name: Authorization
        in: header
        description: 'Firebase ID Token (format: Bearer <token>)'
        required: true
        schema:
          type: string
      responses:
        '200':
          description: successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  life_rule:
                    type: object
        '403':
          description: forbidden
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
  "/api/v1/notifications/send":
    post:
      summary: Send notifications to specific users
      tags:
      - Notifications
      description: Sends push notifications to specific users (Admin only)
      security:
      - bearer_auth: []
      parameters:
      - name: Authorization
        in: header
        description: 'Firebase ID Token (format: Bearer <token>) - Must be admin user'
        required: true
        schema:
          type: string
      responses:
        '200':
          description: successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Notificações enviadas
                  sent_count:
                    type: integer
                    example: 3
                  failed_count:
                    type: integer
                    example: 0
        '401':
          description: unauthorized
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: Unauthorized
        '403':
          description: forbidden
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: Unauthorized - Admin access required
        '422':
          description: unprocessable entity
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: user_ids, title, and body are required
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                user_ids:
                  type: array
                  items:
                    type: integer
                  example:
                  - 1
                  - 2
                  - 3
                title:
                  type: string
                  example: Título da notificação
                body:
                  type: string
                  example: Corpo da notificação
                data:
                  type: object
                  properties:
                    type:
                      type: string
                      example: new_feature
                    url:
                      type: string
                      example: "/path/to/feature"
              required:
              - user_ids
              - title
              - body
  "/api/v1/notifications/broadcast":
    post:
      summary: Broadcast notification to all users
      tags:
      - Notifications
      description: Sends push notification to all users with active FCM tokens (Admin
        only)
      security:
      - bearer_auth: []
      parameters:
      - name: Authorization
        in: header
        description: 'Firebase ID Token (format: Bearer <token>) - Must be admin user'
        required: true
        schema:
          type: string
      responses:
        '202':
          description: accepted - broadcast started in background
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Broadcast iniciado em background
                  total_users:
                    type: integer
                    example: 1500
        '200':
          description: successful - broadcast completed
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Broadcast concluído
                  total_users:
                    type: integer
                    example: 1500
                  sent_count:
                    type: integer
                    example: 1450
                  failed_count:
                    type: integer
                    example: 50
        '401':
          description: unauthorized
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: Unauthorized
        '403':
          description: forbidden
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: Unauthorized - Admin access required
        '422':
          description: unprocessable entity
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: title and body are required
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                title:
                  type: string
                  example: Novo recurso disponível!
                body:
                  type: string
                  example: Confira as novas funcionalidades do Ordo
                data:
                  type: object
                  properties:
                    type:
                      type: string
                      example: announcement
                    url:
                      type: string
                      example: "/announcements/123"
              required:
              - title
              - body
  "/api/v1/users/onboarding":
    post:
      summary: create onboarding
      tags:
      - Onboarding
      security:
      - bearer_auth: []
      parameters:
      - name: Authorization
        in: header
        description: 'Firebase ID Token (format: Bearer <token>)'
        required: true
        schema:
          type: string
      responses:
        '200':
          description: successful - advanced mode
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                  data:
                    type: object
                    properties:
                      id:
                        type: string
                      user_id:
                        type: string
                      prayer_book_id:
                        type: string
                      bible_version_id:
                        type: string
                      mode:
                        type: string
                      preferences:
                        type: object
                      onboarding_completed:
                        type: boolean
                      completed_at:
                        type: string
                      created_at:
                        type: string
                      updated_at:
                        type: string
        '404':
          description: prayer book not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  error:
                    type: object
                    properties:
                      code:
                        type: string
                      message:
                        type: string
        '400':
          description: invalid preferences
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  error:
                    type: object
                    properties:
                      code:
                        type: string
                      message:
                        type: string
                      details:
                        type: object
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                prayer_book_id:
                  type: string
                bible_version_id:
                  type: string
                mode:
                  type: string
                  enum:
                  - basic
                  - advanced
                preferences:
                  type: object
                completed_at:
                  type: string
                  format: datetime
              required:
              - prayer_book_id
              - bible_version_id
  "/api/v1/users/me/onboarding":
    get:
      summary: show onboarding
      tags:
      - Onboarding
      security:
      - bearer_auth: []
      parameters:
      - name: Authorization
        in: header
        description: 'Firebase ID Token (format: Bearer <token>)'
        required: true
        schema:
          type: string
      responses:
        '200':
          description: successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      id:
                        type: string
                      prayer_book_id:
                        type: string
                      bible_version_id:
                        type: string
                      mode:
                        type: string
                      preferences:
                        type: object
        '404':
          description: onboarding not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  error:
                    type: object
                    properties:
                      code:
                        type: string
                      message:
                        type: string
  "/api/v1/prayer_books":
    get:
      summary: list prayer books
      tags:
      - Prayer Books
      description: Returns all available Prayer Books (LOCs), ordered by recommended
        and year
      responses:
        '200':
          description: successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: string
                          example: loc_2015
                        code:
                          type: string
                          example: loc_2015
                        name:
                          type: string
                          example: Livro de Oração Comum - IEAB 2015
                        full_name:
                          type: string
                          example: Livro de Oração Comum - IEAB 2015
                        description:
                          type: string
                          nullable: true
                        language:
                          type: string
                          example: pt-BR
                        jurisdiction:
                          type: string
                          example: Igreja Episcopal Anglicana do Brasil
                          nullable: true
                        year:
                          type: integer
                          example: 2015
                        is_recommended:
                          type: boolean
                          example: true
                        image_url:
                          type: string
                          nullable: true
                        thumbnail_url:
                          type: string
                          nullable: true
                        pdf_url:
                          type: string
                          nullable: true
                        created_at:
                          type: string
                          format: datetime
                        updated_at:
                          type: string
                          format: datetime
                      required:
                      - id
                      - code
                      - name
                      - is_recommended
  "/api/v1/prayer_books/{code}":
    parameters:
    - name: code
      in: path
      description: Prayer book code (e.g., loc_2015, loc_1987)
      required: true
      schema:
        type: string
    get:
      summary: show prayer book
      tags:
      - Prayer Books
      description: Returns details of a specific Prayer Book by its code
      responses:
        '200':
          description: successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      id:
                        type: string
                        example: loc_2015
                      code:
                        type: string
                        example: loc_2015
                      name:
                        type: string
                        example: Livro de Oração Comum - IEAB 2015
                      full_name:
                        type: string
                        example: Livro de Oração Comum - IEAB 2015
                      description:
                        type: string
                        nullable: true
                      language:
                        type: string
                        example: pt-BR
                      jurisdiction:
                        type: string
                        example: Igreja Episcopal Anglicana do Brasil
                        nullable: true
                      year:
                        type: integer
                        example: 2015
                      is_recommended:
                        type: boolean
                        example: true
                      image_url:
                        type: string
                        nullable: true
                      thumbnail_url:
                        type: string
                        nullable: true
                      pdf_url:
                        type: string
                        nullable: true
                      created_at:
                        type: string
                        format: datetime
                      updated_at:
                        type: string
                        format: datetime
                    required:
                    - id
                    - code
                    - name
                    - is_recommended
        '404':
          description: not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: object
                    properties:
                      code:
                        type: string
                      message:
                        type: string
  "/api/v1/prayer_books/{prayer_book_code}/preferences":
    get:
      summary: get prayer book preferences
      tags:
      - Preferences
      parameters:
      - name: prayer_book_code
        in: path
        description: Prayer book code
        required: true
        schema:
          type: string
      responses:
        '200':
          description: successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  prayer_book_id:
                    type: string
                  prayer_book_name:
                    type: string
                  categories:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: string
                        key:
                          type: string
                        name:
                          type: string
                        description:
                          type: string
                        icon:
                          type: string
                        order:
                          type: integer
                        preferences:
                          type: array
                          items:
                            type: object
                            properties:
                              id:
                                type: string
                              key:
                                type: string
                              name:
                                type: string
                              type:
                                type: string
                              required:
                                type: boolean
                              default_value: {}
                  metadata:
                    type: object
                    properties:
                      total_categories:
                        type: integer
                      total_preferences:
                        type: integer
                      version:
                        type: string
        '404':
          description: prayer book not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: object
                    properties:
                      code:
                        type: string
                      message:
                        type: string
  "/api/v1/shared_offices":
    post:
      summary: Create shared office link
      tags:
      - Shared Offices
      description: Creates a shareable link for an office configuration including
        preferences and seed
      parameters: []
      responses:
        '201':
          description: created
          content:
            application/json:
              schema:
                type: object
                properties:
                  short_code:
                    type: string
                    example: zHaD2NJ
                    description: Unique 7-character code for the shared link
                  share_path:
                    type: string
                    example: "/o/zHaD2NJ"
                    description: Path to use in the app deep link
                  expires_at:
                    type: string
                    format: date-time
                    example: '2026-01-02T12:00:00Z'
                    description: Expiration timestamp (30 days from creation)
                  date:
                    type: string
                    format: date
                    example: '2025-12-03'
                  office_type:
                    type: string
                    example: morning
                  prayer_book_code:
                    type: string
                    example: loc_2015
                required:
                - short_code
                - share_path
                - expires_at
                - date
                - office_type
                - prayer_book_code
        '400':
          description: bad request - invalid office type
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: 'Tipo de ofício inválido. Use: morning, midday, evening,
                      compline'
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                date:
                  type: string
                  format: date
                  example: '2025-12-03'
                  description: Date of the office (YYYY-MM-DD)
                office_type:
                  type: string
                  enum:
                  - morning
                  - midday
                  - evening
                  - compline
                  example: morning
                  description: Type of office
                prayer_book_code:
                  type: string
                  example: loc_2015
                  description: Prayer book code
                seed:
                  type: integer
                  example: 12345678
                  description: Randomization seed for deterministic office generation
                preferences:
                  type: object
                  description: User preferences for the office
                  properties:
                    bible_version:
                      type: string
                      example: nvi
                    lords_prayer_version:
                      type: string
                      example: traditional
                    confession_type:
                      type: string
                      example: long
                    creed_type:
                      type: string
                      example: apostles
              required:
              - date
              - office_type
              - prayer_book_code
              - seed
  "/api/v1/shared_offices/{code}":
    get:
      summary: Get shared office by code
      tags:
      - Shared Offices
      description: Returns the shared office data for a given short code. Use this
        data to open the office with the same configuration.
      parameters:
      - name: code
        in: path
        description: The 7-character short code
        example: zHaD2NJ
        required: true
        schema:
          type: string
      responses:
        '200':
          description: successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  short_code:
                    type: string
                    example: zHaD2NJ
                  date:
                    type: string
                    format: date
                    example: '2025-12-03'
                  office_type:
                    type: string
                    example: morning
                  prayer_book_code:
                    type: string
                    example: loc_2015
                  seed:
                    type: integer
                    example: 12345678
                    description: Use this seed when generating the office
                  preferences:
                    type: object
                    description: Preferences to apply when generating the office
                    properties:
                      bible_version:
                        type: string
                        example: nvi
                      lords_prayer_version:
                        type: string
                        example: traditional
                      confession_type:
                        type: string
                        example: long
                      creed_type:
                        type: string
                        example: apostles
                  expires_at:
                    type: string
                    format: date-time
                    example: '2026-01-02T12:00:00Z'
                  created_by:
                    type: string
                    nullable: true
                    example: João Silva
                    description: Name of the user who created the link (if authenticated)
                required:
                - short_code
                - date
                - office_type
                - prayer_book_code
                - seed
                - preferences
                - expires_at
        '404':
          description: not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: Link não encontrado
        '410':
          description: gone - link expired
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: Este link expirou
  "/api/v1/users/me":
    get:
      summary: Get current user profile
      tags:
      - Users
      description: Returns the authenticated user profile including preferences and
        streak information
      security:
      - bearer_auth: []
      parameters:
      - name: Authorization
        in: header
        description: 'Firebase ID Token (format: Bearer <token>)'
        required: true
        schema:
          type: string
      responses:
        '200':
          description: successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: integer
                    example: 1
                  email:
                    type: string
                    example: user@example.com
                  name:
                    type: string
                    example: João Silva
                  photo_url:
                    type: string
                    example: https://example.com/photo.jpg
                    nullable: true
                  preferences:
                    type: object
                    properties:
                      version:
                        type: string
                        example: loc_2015
                      language:
                        type: string
                        example: pt-BR
                      bible_version:
                        type: string
                        example: nvi
                      lords_prayer_version:
                        type: string
                        example: traditional
                      creed_type:
                        type: string
                        example: apostles
                      confession_type:
                        type: string
                        example: long
                      notifications:
                        type: boolean
                        example: true
                      notifications_enabled:
                        type: boolean
                        example: true
                      streak_reminder_enabled:
                        type: boolean
                        example: true
                      prayer_times:
                        type: array
                        items:
                          type: object
                          properties:
                            office_id:
                              type: string
                              example: '1'
                            office_name:
                              type: string
                              example: Matutino
                            hour:
                              type: integer
                              example: 6
                            minute:
                              type: integer
                              example: 0
                            enabled:
                              type: boolean
                              example: true
                  current_streak:
                    type: integer
                    example: 7
                  longest_streak:
                    type: integer
                    example: 15
                  last_completed_office_at:
                    type: string
                    format: date-time
                    example: '2025-11-22T08:30:00Z'
                    nullable: true
        '401':
          description: unauthorized
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: Unauthorized
  "/api/v1/users/preferences":
    patch:
      summary: Update user preferences
      tags:
      - Users
      description: Updates user preferences for customizing the Daily Office experience
      security:
      - bearer_auth: []
      parameters:
      - name: Authorization
        in: header
        description: 'Firebase ID Token (format: Bearer <token>)'
        required: true
        schema:
          type: string
      responses:
        '200':
          description: successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Preferences updated successfully
                  preferences:
                    type: object
                    properties:
                      version:
                        type: string
                      language:
                        type: string
                      bible_version:
                        type: string
                      lords_prayer_version:
                        type: string
                      creed_type:
                        type: string
                      confession_type:
                        type: string
                      notifications:
                        type: boolean
        '401':
          description: unauthorized
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: Unauthorized
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                preferences:
                  type: object
                  properties:
                    version:
                      type: string
                      example: loc_2015
                    language:
                      type: string
                      example: pt-BR
                    bible_version:
                      type: string
                      example: nvi
                    lords_prayer_version:
                      type: string
                      example: traditional
                    creed_type:
                      type: string
                      example: apostles
                    confession_type:
                      type: string
                      example: long
                    notifications:
                      type: boolean
                      example: true
                    notifications_enabled:
                      type: boolean
                      example: true
                    streak_reminder_enabled:
                      type: boolean
                      example: true
                    prayer_times:
                      type: array
                      items:
                        type: object
                        properties:
                          office_id:
                            type: string
                            example: '1'
                          office_name:
                            type: string
                            example: Matutino
                          hour:
                            type: integer
                            example: 6
                          minute:
                            type: integer
                            example: 0
                          enabled:
                            type: boolean
                            example: true
              required:
              - preferences
  "/api/v1/users/completions":
    get:
      summary: Get user completion history
      tags:
      - Users
      description: Returns the authenticated user completion history with streak information
      security:
      - bearer_auth: []
      parameters:
      - name: Authorization
        in: header
        description: 'Firebase ID Token (format: Bearer <token>)'
        required: true
        schema:
          type: string
      - name: limit
        in: query
        description: 'Limit number of results (default: 30)'
        required: false
        schema:
          type: integer
      responses:
        '200':
          description: successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  completions:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: integer
                          example: 1
                        date_reference:
                          type: string
                          format: date
                          example: '2025-11-22'
                        office_type:
                          type: string
                          example: morning
                        duration_seconds:
                          type: integer
                          example: 600
                          nullable: true
                        created_at:
                          type: string
                          format: date-time
                          example: '2025-11-22T08:30:00Z'
                  total_completions:
                    type: integer
                    example: 42
                  current_streak:
                    type: integer
                    example: 7
                  longest_streak:
                    type: integer
                    example: 15
        '401':
          description: unauthorized
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: Unauthorized
  "/api/v1/users/fcm_token":
    post:
      summary: Save FCM token for push notifications
      tags:
      - Users
      description: Saves or updates the FCM (Firebase Cloud Messaging) token for the
        authenticated user to enable push notifications
      security:
      - bearer_auth: []
      parameters:
      - name: Authorization
        in: header
        description: 'Firebase ID Token (format: Bearer <token>)'
        required: true
        schema:
          type: string
      responses:
        '200':
          description: successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Token FCM salvo com sucesso
                  fcm_token:
                    type: string
                    example: fK8x9y2ZqR3...
        '401':
          description: unauthorized
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: Unauthorized
        '422':
          description: unprocessable entity
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: FCM token is required
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                fcm_token:
                  type: string
                  example: fK8x9y2ZqR3...
                platform:
                  type: string
                  enum:
                  - android
                  - ios
                  - web
                  example: android
              required:
              - fcm_token
    delete:
      summary: Remove FCM token
      tags:
      - Users
      description: Removes the FCM token for the authenticated user (e.g., when logging
        out or disabling notifications)
      security:
      - bearer_auth: []
      parameters:
      - name: Authorization
        in: header
        description: 'Firebase ID Token (format: Bearer <token>)'
        required: true
        schema:
          type: string
      - name: fcm_token
        in: query
        description: FCM token to remove
        required: true
        schema:
          type: string
      responses:
        '200':
          description: successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Token FCM removido com sucesso
        '401':
          description: unauthorized
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: Unauthorized
        '422':
          description: unprocessable entity
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: FCM token is required
servers:
- url: http://localhost:3000
  description: Development server
- url: https://api.caminhoanglicano.com.br
  description: Production server
components:
  securitySchemes:
    bearer_auth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: Firebase ID Token. Obtenha através do Firebase Authentication no
        app Flutter.
